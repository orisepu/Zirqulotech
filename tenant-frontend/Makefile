# Checkouters Frontend - Developer Experience Makefile
# Comandos optimizados para desarrollo y CI/CD

.PHONY: help install dev build test clean

# Variables
PNPM := pnpm
NODE_ENV := development

# Default target
help:
	@echo "ğŸš€ Checkouters Frontend - Developer Experience"
	@echo ""
	@echo "Comandos de desarrollo:"
	@echo "  make install    - Instalar dependencias"
	@echo "  make dev        - Desarrollo con Turbopack"
	@echo "  make build      - Build de producciÃ³n"
	@echo "  make clean      - Limpiar archivos generados"
	@echo ""
	@echo "Testing (optimizado para CI/CD):"
	@echo "  make test       - Suite completa de tests"
	@echo "  make test-critical - Solo tests Tier 1 (2min)"
	@echo "  make test-frontend - Solo lÃ³gica frontend (1min)"
	@echo "  make test-watch - Tests en modo watch"
	@echo ""
	@echo "Calidad de cÃ³digo:"
	@echo "  make lint       - ESLint con cache"
	@echo "  make typecheck  - VerificaciÃ³n TypeScript"
	@echo "  make dx-check   - VerificaciÃ³n completa pre-commit"
	@echo "  make dx-fix     - CorrecciÃ³n automÃ¡tica de issues"
	@echo ""
	@echo "Multi-tenant:"
	@echo "  make dev-tenant TENANT=progeek - Desarrollo con tenant especÃ­fico"
	@echo "  make test-tenant TENANT=test   - Tests con contexto tenant"

# Installation
install:
	@echo "ğŸ“¦ Instalando dependencias..."
	$(PNPM) install

# Development
dev:
	@echo "ğŸš€ Iniciando desarrollo con Turbopack..."
	$(PNPM) dev

dev-legacy:
	@echo "ğŸ”„ Iniciando desarrollo sin Turbopack..."
	$(PNPM) dev:legacy

dev-tenant:
	@echo "ğŸ¢ Desarrollo con tenant: $(TENANT)"
	@NEXT_PUBLIC_DEFAULT_TENANT=$(TENANT) $(PNPM) dev

# Build
build:
	@echo "ğŸ—ï¸ Building para producciÃ³n..."
	$(PNPM) build

build-analyze:
	@echo "ğŸ“Š Build con anÃ¡lisis de bundle..."
	$(PNPM) build:analyze

# Testing (Tiered approach optimizado para CI/CD)
test:
	@echo "ğŸ§ª Ejecutando suite completa de tests..."
	./scripts/test-ci.sh full

test-critical:
	@echo "ğŸš€ Tests crÃ­ticos (Tier 1) - APIs esenciales..."
	./scripts/test-ci.sh critical

test-frontend:
	@echo "ğŸ¨ Tests de lÃ³gica frontend..."
	./scripts/test-ci.sh frontend

test-health:
	@echo "â¤ï¸ Health check - todos los endpoints..."
	./scripts/test-ci.sh health

test-watch:
	@echo "ğŸ‘€ Tests en modo watch..."
	$(PNPM) test:watch

test-coverage:
	@echo "ğŸ“Š Tests con reporte de coverage..."
	$(PNPM) test:coverage

test-tenant:
	@echo "ğŸ¢ Tests con contexto tenant: $(TENANT)"
	@NEXT_PUBLIC_DEFAULT_TENANT=$(TENANT) $(PNPM) test:critical

# Code Quality
lint:
	@echo "ğŸ” Ejecutando ESLint..."
	$(PNPM) lint

lint-fix:
	@echo "ğŸ”§ Corrigiendo issues de ESLint..."
	$(PNPM) lint:fix

typecheck:
	@echo "ğŸ“ Verificando TypeScript..."
	$(PNPM) typecheck

typecheck-watch:
	@echo "ğŸ‘€ TypeScript en modo watch..."
	$(PNPM) typecheck:watch

# Developer Experience
dx-check:
	@echo "âœ… VerificaciÃ³n completa pre-commit..."
	./scripts/test-ci.sh pre-commit

dx-fix:
	@echo "ğŸ”§ CorrecciÃ³n automÃ¡tica de issues..."
	$(PNPM) dx:fix

dx-setup:
	@echo "âš™ï¸ ConfiguraciÃ³n inicial del entorno..."
	./scripts/dev-setup.sh

# Maintenance
clean:
	@echo "ğŸ§¹ Limpiando archivos generados..."
	$(PNPM) clean

clean-all:
	@echo "ğŸ§¹ Limpieza completa (incluyendo node_modules)..."
	$(PNPM) clean:all

reset:
	@echo "ğŸ”„ Reset completo del proyecto..."
	$(PNPM) clean:all
	$(PNPM) install

# CI/CD Helpers
ci-install:
	@echo "ğŸ¤– CI: InstalaciÃ³n..."
	$(PNPM) install --frozen-lockfile

ci-test:
	@echo "ğŸ¤– CI: Testing completo..."
	make dx-check
	make test

ci-build:
	@echo "ğŸ¤– CI: Build y verificaciÃ³n..."
	make build
	@echo "âœ… CI pipeline completado"

# Performance
perf-build:
	@echo "âš¡ AnÃ¡lisis de performance de build..."
	time make build

perf-test:
	@echo "âš¡ AnÃ¡lisis de performance de tests..."
	time make test-critical